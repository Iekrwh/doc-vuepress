<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka原理 | Chiriri</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/doc-vuepress/favicon.ico">
    <meta name="description" content="Chiriridesu">
    
    <link rel="preload" href="/doc-vuepress/assets/css/0.styles.f3cbd881.css" as="style"><link rel="preload" href="/doc-vuepress/assets/js/app.d9f058a2.js" as="script"><link rel="preload" href="/doc-vuepress/assets/js/2.3b3db5cf.js" as="script"><link rel="preload" href="/doc-vuepress/assets/js/143.2226636a.js" as="script"><link rel="prefetch" href="/doc-vuepress/assets/js/10.b164b477.js"><link rel="prefetch" href="/doc-vuepress/assets/js/100.9586193b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/101.fbfb8023.js"><link rel="prefetch" href="/doc-vuepress/assets/js/102.35211624.js"><link rel="prefetch" href="/doc-vuepress/assets/js/103.a852832b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/104.d3840a25.js"><link rel="prefetch" href="/doc-vuepress/assets/js/105.bb97f57b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/106.f1ce2ff3.js"><link rel="prefetch" href="/doc-vuepress/assets/js/107.bcc1af18.js"><link rel="prefetch" href="/doc-vuepress/assets/js/108.aea72a13.js"><link rel="prefetch" href="/doc-vuepress/assets/js/109.ea26c2b6.js"><link rel="prefetch" href="/doc-vuepress/assets/js/11.0cc7b3fe.js"><link rel="prefetch" href="/doc-vuepress/assets/js/110.1dbc43ae.js"><link rel="prefetch" href="/doc-vuepress/assets/js/111.6c704305.js"><link rel="prefetch" href="/doc-vuepress/assets/js/112.2104312f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/113.3af2e44c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/114.83fa7f12.js"><link rel="prefetch" href="/doc-vuepress/assets/js/115.03b9877c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/116.94139d50.js"><link rel="prefetch" href="/doc-vuepress/assets/js/117.d6922e84.js"><link rel="prefetch" href="/doc-vuepress/assets/js/118.d6600176.js"><link rel="prefetch" href="/doc-vuepress/assets/js/119.6e2fc19d.js"><link rel="prefetch" href="/doc-vuepress/assets/js/12.42e85628.js"><link rel="prefetch" href="/doc-vuepress/assets/js/120.fb904b71.js"><link rel="prefetch" href="/doc-vuepress/assets/js/121.e5418133.js"><link rel="prefetch" href="/doc-vuepress/assets/js/122.23684851.js"><link rel="prefetch" href="/doc-vuepress/assets/js/123.a2201e8f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/124.5398a4db.js"><link rel="prefetch" href="/doc-vuepress/assets/js/125.acf77852.js"><link rel="prefetch" href="/doc-vuepress/assets/js/126.8cc2a7ef.js"><link rel="prefetch" href="/doc-vuepress/assets/js/127.636078e5.js"><link rel="prefetch" href="/doc-vuepress/assets/js/128.3dda16ec.js"><link rel="prefetch" href="/doc-vuepress/assets/js/129.76fb4160.js"><link rel="prefetch" href="/doc-vuepress/assets/js/13.22626cf9.js"><link rel="prefetch" href="/doc-vuepress/assets/js/130.4050b596.js"><link rel="prefetch" href="/doc-vuepress/assets/js/131.dcf83479.js"><link rel="prefetch" href="/doc-vuepress/assets/js/132.34df2699.js"><link rel="prefetch" href="/doc-vuepress/assets/js/133.0c2f2395.js"><link rel="prefetch" href="/doc-vuepress/assets/js/134.631acf38.js"><link rel="prefetch" href="/doc-vuepress/assets/js/135.3c7a8002.js"><link rel="prefetch" href="/doc-vuepress/assets/js/136.9d498fad.js"><link rel="prefetch" href="/doc-vuepress/assets/js/137.52b3491f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/138.2def15df.js"><link rel="prefetch" href="/doc-vuepress/assets/js/139.2027a741.js"><link rel="prefetch" href="/doc-vuepress/assets/js/14.a0e74d71.js"><link rel="prefetch" href="/doc-vuepress/assets/js/140.14025373.js"><link rel="prefetch" href="/doc-vuepress/assets/js/141.3be2fa6f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/142.7a2f26a6.js"><link rel="prefetch" href="/doc-vuepress/assets/js/144.d6cb4516.js"><link rel="prefetch" href="/doc-vuepress/assets/js/145.cb3d04a4.js"><link rel="prefetch" href="/doc-vuepress/assets/js/146.c2363b65.js"><link rel="prefetch" href="/doc-vuepress/assets/js/147.2d96c979.js"><link rel="prefetch" href="/doc-vuepress/assets/js/148.1932e886.js"><link rel="prefetch" href="/doc-vuepress/assets/js/149.2bb44329.js"><link rel="prefetch" href="/doc-vuepress/assets/js/15.487511b9.js"><link rel="prefetch" href="/doc-vuepress/assets/js/150.54f16e16.js"><link rel="prefetch" href="/doc-vuepress/assets/js/151.1ccddd4a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/152.c2aae540.js"><link rel="prefetch" href="/doc-vuepress/assets/js/153.818ba26e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/154.4083fc73.js"><link rel="prefetch" href="/doc-vuepress/assets/js/155.fcb284df.js"><link rel="prefetch" href="/doc-vuepress/assets/js/156.2d9dd10c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/157.2d97df21.js"><link rel="prefetch" href="/doc-vuepress/assets/js/158.b933259f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/159.127ec2ce.js"><link rel="prefetch" href="/doc-vuepress/assets/js/16.99912d5c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/160.7a9466de.js"><link rel="prefetch" href="/doc-vuepress/assets/js/161.a0965a1e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/162.9ba63ff6.js"><link rel="prefetch" href="/doc-vuepress/assets/js/163.113f0d78.js"><link rel="prefetch" href="/doc-vuepress/assets/js/164.77e0c395.js"><link rel="prefetch" href="/doc-vuepress/assets/js/165.d4f26c88.js"><link rel="prefetch" href="/doc-vuepress/assets/js/166.a4a8a100.js"><link rel="prefetch" href="/doc-vuepress/assets/js/167.f1a4e055.js"><link rel="prefetch" href="/doc-vuepress/assets/js/168.28bca86c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/169.b99892fc.js"><link rel="prefetch" href="/doc-vuepress/assets/js/17.31966cc8.js"><link rel="prefetch" href="/doc-vuepress/assets/js/170.0d63cca0.js"><link rel="prefetch" href="/doc-vuepress/assets/js/171.150d95f7.js"><link rel="prefetch" href="/doc-vuepress/assets/js/172.82820234.js"><link rel="prefetch" href="/doc-vuepress/assets/js/173.d8cdd9b8.js"><link rel="prefetch" href="/doc-vuepress/assets/js/174.cc3e8688.js"><link rel="prefetch" href="/doc-vuepress/assets/js/175.c85fb692.js"><link rel="prefetch" href="/doc-vuepress/assets/js/176.a9864030.js"><link rel="prefetch" href="/doc-vuepress/assets/js/177.01f901aa.js"><link rel="prefetch" href="/doc-vuepress/assets/js/178.d4d7719a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/179.8e5df995.js"><link rel="prefetch" href="/doc-vuepress/assets/js/18.487740e0.js"><link rel="prefetch" href="/doc-vuepress/assets/js/180.c283ed3a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/181.4d553ce8.js"><link rel="prefetch" href="/doc-vuepress/assets/js/182.5f1d0255.js"><link rel="prefetch" href="/doc-vuepress/assets/js/183.bdbabf31.js"><link rel="prefetch" href="/doc-vuepress/assets/js/184.cd3a123a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/185.4f0aed34.js"><link rel="prefetch" href="/doc-vuepress/assets/js/186.1c7423c5.js"><link rel="prefetch" href="/doc-vuepress/assets/js/187.a3260f92.js"><link rel="prefetch" href="/doc-vuepress/assets/js/188.b2b395d2.js"><link rel="prefetch" href="/doc-vuepress/assets/js/189.c3e16d42.js"><link rel="prefetch" href="/doc-vuepress/assets/js/19.a5a43fa0.js"><link rel="prefetch" href="/doc-vuepress/assets/js/190.0027611b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/191.5da79366.js"><link rel="prefetch" href="/doc-vuepress/assets/js/192.de572ba5.js"><link rel="prefetch" href="/doc-vuepress/assets/js/193.e7eecd76.js"><link rel="prefetch" href="/doc-vuepress/assets/js/194.c0c9a3e1.js"><link rel="prefetch" href="/doc-vuepress/assets/js/195.4c9e640a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/196.bca887a2.js"><link rel="prefetch" href="/doc-vuepress/assets/js/197.32b3ef9a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/198.36dd1121.js"><link rel="prefetch" href="/doc-vuepress/assets/js/199.a7a2ea66.js"><link rel="prefetch" href="/doc-vuepress/assets/js/20.f16a556e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/200.541d2d45.js"><link rel="prefetch" href="/doc-vuepress/assets/js/201.2a6bc31e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/202.1ab0ebf7.js"><link rel="prefetch" href="/doc-vuepress/assets/js/203.8ea83886.js"><link rel="prefetch" href="/doc-vuepress/assets/js/204.71960433.js"><link rel="prefetch" href="/doc-vuepress/assets/js/205.face6c2c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/206.edb32265.js"><link rel="prefetch" href="/doc-vuepress/assets/js/207.7edd2587.js"><link rel="prefetch" href="/doc-vuepress/assets/js/208.8eb4dd8a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/209.1e71f98c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/21.80c27c79.js"><link rel="prefetch" href="/doc-vuepress/assets/js/210.d0362700.js"><link rel="prefetch" href="/doc-vuepress/assets/js/211.ad68c64c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/212.8b718048.js"><link rel="prefetch" href="/doc-vuepress/assets/js/213.4ba985f2.js"><link rel="prefetch" href="/doc-vuepress/assets/js/214.07f64a1f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/215.daee3c3e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/216.32992c2f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/217.7529cd64.js"><link rel="prefetch" href="/doc-vuepress/assets/js/218.0ca3a67d.js"><link rel="prefetch" href="/doc-vuepress/assets/js/219.e61a2c40.js"><link rel="prefetch" href="/doc-vuepress/assets/js/22.c30ea85f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/220.251d745a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/221.1d95ee5c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/222.4a52a281.js"><link rel="prefetch" href="/doc-vuepress/assets/js/223.5647c4eb.js"><link rel="prefetch" href="/doc-vuepress/assets/js/224.e27da076.js"><link rel="prefetch" href="/doc-vuepress/assets/js/225.896a2b7e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/226.9269748b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/227.f7fc3384.js"><link rel="prefetch" href="/doc-vuepress/assets/js/228.3c17af77.js"><link rel="prefetch" href="/doc-vuepress/assets/js/23.b160b248.js"><link rel="prefetch" href="/doc-vuepress/assets/js/24.52ffcd3c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/25.0038c555.js"><link rel="prefetch" href="/doc-vuepress/assets/js/26.c1d32d66.js"><link rel="prefetch" href="/doc-vuepress/assets/js/27.361aa74e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/28.301d1f1b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/29.db696a70.js"><link rel="prefetch" href="/doc-vuepress/assets/js/3.618cc386.js"><link rel="prefetch" href="/doc-vuepress/assets/js/30.82c215a1.js"><link rel="prefetch" href="/doc-vuepress/assets/js/31.4218ee88.js"><link rel="prefetch" href="/doc-vuepress/assets/js/32.185a0605.js"><link rel="prefetch" href="/doc-vuepress/assets/js/33.8e56a2c2.js"><link rel="prefetch" href="/doc-vuepress/assets/js/34.e93b30c8.js"><link rel="prefetch" href="/doc-vuepress/assets/js/35.c029905f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/36.3c26314a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/37.281e9bbf.js"><link rel="prefetch" href="/doc-vuepress/assets/js/38.95142af3.js"><link rel="prefetch" href="/doc-vuepress/assets/js/39.7b46210b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/4.ab196059.js"><link rel="prefetch" href="/doc-vuepress/assets/js/40.da793450.js"><link rel="prefetch" href="/doc-vuepress/assets/js/41.ae5d114c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/42.6092d6fd.js"><link rel="prefetch" href="/doc-vuepress/assets/js/43.3676ecec.js"><link rel="prefetch" href="/doc-vuepress/assets/js/44.604dee90.js"><link rel="prefetch" href="/doc-vuepress/assets/js/45.ef7b2563.js"><link rel="prefetch" href="/doc-vuepress/assets/js/46.5126b263.js"><link rel="prefetch" href="/doc-vuepress/assets/js/47.15c9fa2f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/48.4d000b30.js"><link rel="prefetch" href="/doc-vuepress/assets/js/49.c04122ec.js"><link rel="prefetch" href="/doc-vuepress/assets/js/5.61dedc87.js"><link rel="prefetch" href="/doc-vuepress/assets/js/50.b36b2268.js"><link rel="prefetch" href="/doc-vuepress/assets/js/51.38b2e042.js"><link rel="prefetch" href="/doc-vuepress/assets/js/52.fa2688bf.js"><link rel="prefetch" href="/doc-vuepress/assets/js/53.8e7b4e2a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/54.cc60f637.js"><link rel="prefetch" href="/doc-vuepress/assets/js/55.c593a0bd.js"><link rel="prefetch" href="/doc-vuepress/assets/js/56.b92ff64e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/57.0127b901.js"><link rel="prefetch" href="/doc-vuepress/assets/js/58.b51e39e7.js"><link rel="prefetch" href="/doc-vuepress/assets/js/59.4656872e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/6.7862f44a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/60.0b84f136.js"><link rel="prefetch" href="/doc-vuepress/assets/js/61.77bb1c42.js"><link rel="prefetch" href="/doc-vuepress/assets/js/62.255b2396.js"><link rel="prefetch" href="/doc-vuepress/assets/js/63.0784c59f.js"><link rel="prefetch" href="/doc-vuepress/assets/js/64.bfd10989.js"><link rel="prefetch" href="/doc-vuepress/assets/js/65.271e0fe0.js"><link rel="prefetch" href="/doc-vuepress/assets/js/66.37d35e9b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/67.1f723e6e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/68.1d6b4d62.js"><link rel="prefetch" href="/doc-vuepress/assets/js/69.751866f7.js"><link rel="prefetch" href="/doc-vuepress/assets/js/7.16153ad4.js"><link rel="prefetch" href="/doc-vuepress/assets/js/70.5a176ed9.js"><link rel="prefetch" href="/doc-vuepress/assets/js/71.cefafd88.js"><link rel="prefetch" href="/doc-vuepress/assets/js/72.89cf0ee7.js"><link rel="prefetch" href="/doc-vuepress/assets/js/73.7ae1caa5.js"><link rel="prefetch" href="/doc-vuepress/assets/js/74.3a0426c5.js"><link rel="prefetch" href="/doc-vuepress/assets/js/75.346a5b12.js"><link rel="prefetch" href="/doc-vuepress/assets/js/76.40d6b949.js"><link rel="prefetch" href="/doc-vuepress/assets/js/77.af42e53e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/78.a1a1041d.js"><link rel="prefetch" href="/doc-vuepress/assets/js/79.3979b3e2.js"><link rel="prefetch" href="/doc-vuepress/assets/js/8.51f8b48e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/80.ddedd06c.js"><link rel="prefetch" href="/doc-vuepress/assets/js/81.f47899f4.js"><link rel="prefetch" href="/doc-vuepress/assets/js/82.b64b79c5.js"><link rel="prefetch" href="/doc-vuepress/assets/js/83.3d3b0dd8.js"><link rel="prefetch" href="/doc-vuepress/assets/js/84.f20ba61e.js"><link rel="prefetch" href="/doc-vuepress/assets/js/85.3a85fe1a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/86.a2c68016.js"><link rel="prefetch" href="/doc-vuepress/assets/js/87.e498e9cf.js"><link rel="prefetch" href="/doc-vuepress/assets/js/88.16da169b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/89.dfdd9486.js"><link rel="prefetch" href="/doc-vuepress/assets/js/9.b89c29c6.js"><link rel="prefetch" href="/doc-vuepress/assets/js/90.9dfc4480.js"><link rel="prefetch" href="/doc-vuepress/assets/js/91.29fae888.js"><link rel="prefetch" href="/doc-vuepress/assets/js/92.3a2f5266.js"><link rel="prefetch" href="/doc-vuepress/assets/js/93.2a30db4b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/94.d73d493b.js"><link rel="prefetch" href="/doc-vuepress/assets/js/95.4675d725.js"><link rel="prefetch" href="/doc-vuepress/assets/js/96.ba849b11.js"><link rel="prefetch" href="/doc-vuepress/assets/js/97.167b1f35.js"><link rel="prefetch" href="/doc-vuepress/assets/js/98.cd43851a.js"><link rel="prefetch" href="/doc-vuepress/assets/js/99.6b57d9c5.js">
    <link rel="stylesheet" href="/doc-vuepress/assets/css/0.styles.f3cbd881.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/doc-vuepress/" class="home-link router-link-active"><!----> <span class="site-name">Chiriri</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/doc-vuepress/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc-vuepress/JavaSE/" class="nav-link">
  JavaSE
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/JavaEE/" class="nav-link">
  JavaEE
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/SQL/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/机器学习/" class="nav-link">
  机器学习
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Python模块/" class="nav-link">
  Python模块
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc-vuepress/Hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Hive/" class="nav-link">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Flume/" class="nav-link">
  Flume
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Kafka/" class="nav-link router-link-active">
  Kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc-vuepress/前端/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Vue/" class="nav-link">
  Vue
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/doc-vuepress/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc-vuepress/JavaSE/" class="nav-link">
  JavaSE
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/JavaEE/" class="nav-link">
  JavaEE
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/SQL/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/机器学习/" class="nav-link">
  机器学习
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Python模块/" class="nav-link">
  Python模块
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><span class="title">大数据</span> <span class="arrow down"></span></button> <button type="button" aria-label="大数据" class="mobile-dropdown-title"><span class="title">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc-vuepress/Hadoop/" class="nav-link">
  Hadoop
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Hive/" class="nav-link">
  Hive
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Flume/" class="nav-link">
  Flume
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Kafka/" class="nav-link router-link-active">
  Kafka
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/doc-vuepress/前端/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/doc-vuepress/Vue/" class="nav-link">
  Vue
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/doc-vuepress/Kafka/架构.html" class="sidebar-link">架构</a></li><li><a href="/doc-vuepress/Kafka/Kafka 安装.html" class="sidebar-link">Kafka 安装</a></li><li><a href="/doc-vuepress/Kafka/命令操作.html" class="sidebar-link">命令操作</a></li><li><a href="/doc-vuepress/Kafka/Kafka原理.html" class="active sidebar-link">Kafka原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#kafka-工作流程和文件存储机制" class="sidebar-link">Kafka 工作流程和文件存储机制</a></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#kafka-生产者" class="sidebar-link">Kafka 生产者</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#分区策略" class="sidebar-link">分区策略</a></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#数据可靠性保证" class="sidebar-link">数据可靠性保证</a></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#exactly-once语义-幂等性" class="sidebar-link">Exactly Once语义 (幂等性)</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#kafka-消费者" class="sidebar-link">Kafka 消费者</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#消费方式" class="sidebar-link">消费方式</a></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#分区分配策略" class="sidebar-link">分区分配策略</a></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#offset的维护" class="sidebar-link">offset的维护</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#kafka高效读写数据" class="sidebar-link">Kafka高效读写数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#顺序写磁盘" class="sidebar-link">顺序写磁盘</a></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#应用pagecache" class="sidebar-link">应用Pagecache</a></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#零拷贝" class="sidebar-link">零拷贝</a></li></ul></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#zookeeper在kafka的作用" class="sidebar-link">Zookeeper在Kafka的作用</a></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#kafka事务" class="sidebar-link">Kafka事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#producer事务" class="sidebar-link">Producer事务</a></li><li class="sidebar-sub-header"><a href="/doc-vuepress/Kafka/Kafka原理.html#consumer事务-精准一次性消费" class="sidebar-link">Consumer事务（精准一次性消费）</a></li></ul></li></ul></li><li><a href="/doc-vuepress/Kafka/Kafka API.html" class="sidebar-link">Kafka API</a></li><li><a href="/doc-vuepress/Kafka/Flume 对接 Kafka.html" class="sidebar-link">Flume 对接 Kafka</a></li><li><a href="/doc-vuepress/Kafka/Kafka监控.html" class="sidebar-link">Kafka监控</a></li><li><a href="/doc-vuepress/Kafka/Kafka面试题.html" class="sidebar-link">Kafka面试题</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kafka原理"><a href="#kafka原理" class="header-anchor">#</a> Kafka原理</h1> <h2 id="kafka-工作流程和文件存储机制"><a href="#kafka-工作流程和文件存储机制" class="header-anchor">#</a> Kafka 工作流程和文件存储机制</h2> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211113185455788.png" alt="image-20211113185455788"></p> <p>Kafka中消息是以<strong>topic</strong>进行分类的，生产者生产消息，消费者消费消息，都是面向topic的。</p> <p>topic是逻辑上的概念，而partition是物理上的概念，每个partition<strong>对应于一个log文件</strong>，该log文件中存储的就是producer生产的数据。Producer生产的数据会被不断追加到该<strong>log文件末端</strong>，且<strong>每条数据都有自己的offset</strong>。消费者组中的每个消费者，都会<strong>实时记录自己消费到了哪个offset</strong>，以便<strong>出错恢复时</strong>，<strong>从上次的位置</strong>继续消费。</p> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211113185613355.png" alt="image-20211113185613355"></p> <p>配置文件中 1个星期清除 之前的被切割的文件  1GB切割为1个文件</p> <p>由于生产者生产的消息会不断追加到log文件末尾，为防止log文件过大导致数据定位效率低下，Kafka采取了<strong>分片</strong>和<strong>索引</strong>机制，将每个partition分为多个segment。每个segment对应两个文件——“.index”文件和“.log”文件。这些文件位于一个文件夹下，该文件夹的命名规则为：topic名称+分区序号。例如，first这个topic有三个分区，则其对应的文件夹为first-0,first-1,first-2。</p> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211113203230573.png" alt="image-20211113203230573"></p> <h2 id="kafka-生产者"><a href="#kafka-生产者" class="header-anchor">#</a> Kafka 生产者</h2> <h3 id="分区策略"><a href="#分区策略" class="header-anchor">#</a> 分区策略</h3> <ol><li>分区的原因
<ol><li>方便在集群中<strong>扩展</strong>，每个Partition可以通过调整以适应它所在的机器，而一个topic又可以有多个Partition组成，因此整个集群就可以适应任意大小的数据了；</li> <li>可以<strong>提高并发</strong>，因为可以以Partition为单位读写了</li></ol></li> <li>分区的原则
<ol><li><strong>指明 partition</strong> 的情况下，直接将指明的值直接作为 partiton 值；</li> <li>没有指明 partition 值但有 key 的情况下，<strong>将 key 的 hash 值与 topic 的 partition 数进行取余得到 partition 值</strong>；</li> <li>既没有 partition 值又没有 key 值的情况下，<strong>第一次调用时随机生成一个整数（后面每次调用在这个整数上自增）</strong>，<strong>将这个值与 topic 可用的 partition 总数取余得到 partition 值，也就是常说的 round-robin 算法</strong>。</li></ol></li></ol> <h3 id="数据可靠性保证"><a href="#数据可靠性保证" class="header-anchor">#</a> 数据可靠性保证</h3> <p>为保证producer发送的数据，能可靠的发送到指定的topic，topic的每个partition收到producer发送的数据后，都需要向producer发送ack（acknowledgement确认收到），<strong>如果producer收到ack，就会进行下一轮的发送，否则重新发送数据。</strong></p> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211120175154412.png" alt="image-20211120175154412"></p> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211120175139137.png" alt="image-20211120175139137"></p> <table><thead><tr><th><strong>方案</strong></th> <th><strong>优点</strong></th> <th><strong>缺点</strong></th></tr></thead> <tbody><tr><td><strong>半数以上完成同步，就发送ack</strong></td> <td>延迟低</td> <td>选举新的leader时，容忍n台节点的故障，需要2n+1个副本</td></tr> <tr><td><strong>全部完成同步，才发送ack</strong></td> <td>选举新的leader时，容忍n台节点的故障，需要n+1个副本</td> <td>延迟高</td></tr></tbody></table> <p>Kafka选择了第二种方案 虽然第二种方案的网络延迟会比较高，但<strong>网络延迟对Kafka的影响较小</strong></p> <p>同样为了容忍n台节点的故障，第一种方案需要2n+1个副本，而第二种方案只需要n+1个副本，而Kafka的每个分区都有大量的数据，第一种方案会造成<strong>大量数据的冗余</strong></p> <h4 id="isr"><a href="#isr" class="header-anchor">#</a> ISR</h4> <p><strong>Leader</strong>维护了一个动态的in-sync replica set (ISR)，意为和leader保持同步的follower集合。当ISR中的follower完成数据的同步之后，leader就会给producer发送ack。<strong>如果follower长时间未向leader同步数据，则该follower将被踢出ISR</strong>，该时间阈值由<strong>replica.lag.time.max.ms</strong>参数设定。Leader发生<strong>故障</strong>之后，就会<strong>从ISR中选举新的leader</strong>。</p> <h4 id="故障处理细节"><a href="#故障处理细节" class="header-anchor">#</a> 故障处理细节</h4> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211113210933050.png" alt="image-20211113210933050"></p> <ol><li>follower故障
follower发生故障后会被<strong>临时踢出ISR</strong>，待该follower<strong>恢复</strong>后，follower会<strong>读取本地磁盘记录的上次的HW</strong>，并将log文件<strong>高于HW</strong>的<strong>部分截取掉</strong>，从HW开始<strong>向leader进行同步</strong>。等该follower的LEO大于等于该Partition的HW，<strong>即follower追上leader之后，就可以重新加入ISR了</strong>。</li> <li>leader故障
leader发生故障之后，会从<strong>ISR</strong>中<strong>选出一个新</strong>的leader，之后，为保证多个副本之间的数据一致性，<strong>其余的follower会先将各自的log文件高于HW的部分截掉，然后从新的leader同步数据</strong>。</li></ol> <p>注意：<strong>这只能保证副本之间的数据一致性，并不能保证数据不丢失或者不重复</strong>。</p> <h4 id="ack应答机制"><a href="#ack应答机制" class="header-anchor">#</a> ack应答机制</h4> <p>对于某些不太重要的数据，对数据的可靠性要求不是很高，能够容忍数据的少量丢失，所以没必要等ISR中的follower全部接收成功。</p> <p>所以Kafka为用户提供了三种可靠性级别，用户根据对可靠性和延迟的要求进行权衡，选择以下的配置。</p> <p>-1（all）：producer等待broker的ack，partition的leader和follower全部落盘成功后才返回ack。但是如果在follower同步完成后，broker发送ack之前，leader发生故障，那么会造成<strong>数据重复</strong>。</p> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211117163716242.png" alt="image-20211117163716242"></p> <p>0：producer不等待broker的ack，这一操作提供了一个最低的延迟，broker一接收到还没有写入磁盘就已经返回，当broker故障时有可能<strong>丢失数据</strong>；</p> <p>1：producer等待broker的ack，partition的leader落盘成功后返回ack，如果在follower同步成功之前leader故障，那么将会<strong>丢失数据</strong>；</p> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211117163745782.png" alt="image-20211117163745782"></p> <h3 id="exactly-once语义-幂等性"><a href="#exactly-once语义-幂等性" class="header-anchor">#</a> Exactly Once语义 (幂等性)</h3> <p>将服务器的ACK级别设置为**-1**，可以保证Producer到Server之间不会丢失数据，即<strong>At Least Once</strong>语义。相对的，将服务器ACK级别设置为<strong>0</strong>，可以保证生产者每条消息只会被发送一次，即<strong>At Most Once</strong>语义。</p> <p>At Least Once可以保证数据不丢失，但是不能保证数据不重复；相对的，At Least Once可以保证数据不重复，但是不能保证数据不丢失。但是，对于一些非常重要的信息，比如说交易数据，下游数据消费者要求数据既不重复也不丢失，即Exactly Once语义。</p> <p>在0.11版本以前的Kafka，对于<strong>数据重复是无能为力</strong>的，只能保证数据不丢失，再在下游消费者对数据做全局去重。对于多个下游应用的情况，每个都需要<strong>单独做全局去重</strong>，这就对<strong>性能</strong>造成了<strong>很大影响</strong>。</p> <p>0.11版本的Kafka，引入了一项重大特性：<strong>幂等性</strong>。所谓的幂等性就是**指Producer不论向Server发送多少次重复数据，Server端都只会持久化一条。**幂等性结合At Least Once语义，就构成了Kafka的Exactly Once语义。即：</p> <p>At Least Once + 幂等性 = Exactly Once</p> <p>要<strong>启用幂等性</strong>，只需要将<strong>Producer的参数中enable.idompotence设置为true即可</strong>。Kafka的幂等性实现其实就是<strong>将原来下游需要做的去重放在了数据上游</strong>。开启幂等性的Producer在初始化的时候会被分配一个<strong>PID</strong>，发往同一Partition的消息会附带Sequence Number。而Broker端会对**&lt;PID, Partition, SeqNumber&gt;<strong>做缓存，当具有</strong>相同主键<strong>的消息提交时，Broker</strong>只会持久化一条**。</p> <p>但是<strong>PID重启就会变化</strong>，同时不同的Partition也具有不同主键，所以<strong>幂等性无法保证跨分区跨会话的Exactly Once</strong>。</p> <h2 id="kafka-消费者"><a href="#kafka-消费者" class="header-anchor">#</a> Kafka 消费者</h2> <h3 id="消费方式"><a href="#消费方式" class="header-anchor">#</a> 消费方式</h3> <p>consumer采用<strong>pull</strong>（拉）模式从broker中读取数据。</p> <p><strong>push</strong>（推）模式很难适应消费速率不同的消费者，因为消息发送速率是由broker决定的。它的目标是尽可能以最快速度传递消息，但是这样很<strong>容易造成consumer来不及处理消息</strong>，典型的表现就是<strong>拒绝服务以及网络拥塞</strong>。</p> <p>而pull模式则可以根据consumer的消费能力以适当的速率消费消息。</p> <p>pull模式不足之处是，<strong>如果kafka没有数据，消费者可能会陷入循环中，一直返回空数据</strong>。</p> <p>针对这一点，Kafka的<strong>消费者在消费数据时</strong>会传入一个时长参数<strong>timeout</strong>，如果当前没有数据可供消费，consumer会<strong>等待一段时间之后再返回</strong>，这段时长即为timeout。</p> <h3 id="分区分配策略"><a href="#分区分配策略" class="header-anchor">#</a> 分区分配策略</h3> <p>一个consumer group中有多个consumer，一个 topic有多个partition，所以必然会涉及到partition的分配问题，即确定那个partition由哪个consumer来消费。</p> <p>Kafka有两种分配策略</p> <ol><li>roundrobin  轮询策略</li> <li>range 随机分配</li></ol> <h3 id="offset的维护"><a href="#offset的维护" class="header-anchor">#</a> offset的维护</h3> <p>由于consumer在消费过程中可能会出现断电宕机等故障，consumer恢复后，需要从故障前的位置的继续消费，所以consumer需要<strong>实时记录自己消费到了哪个offset</strong>，以便故障恢复后继续消费。</p> <p>Kafka 0.9版本之前，consumer默认将offset保存在Zookeeper中，从0.9版本开始，consumer默认将<strong>offset保存在Kafka一个内置的topic中</strong>，该topic为**__consumer_offsets**。</p> <h2 id="kafka高效读写数据"><a href="#kafka高效读写数据" class="header-anchor">#</a> Kafka高效读写数据</h2> <h3 id="顺序写磁盘"><a href="#顺序写磁盘" class="header-anchor">#</a> 顺序写磁盘</h3> <p>Kafka的producer生产数据，要写入到log文件中，写的过程是一直追加到文件末端，为顺序写。这与磁盘的机械机构有关，顺序写之所以快，是因为其省去了大量磁头寻址的时间。</p> <h3 id="应用pagecache"><a href="#应用pagecache" class="header-anchor">#</a> 应用Pagecache</h3> <p><strong>磁盘高速缓存（PageCache）</strong> Kafka数据持久化是直接持久化到Pagecache中</p> <ul><li>I/O Scheduler 会将连续的<strong>小块写组装成大块</strong>的物理写从而提高性能</li> <li>I/O Scheduler 会尝试将一些写操作<strong>重新按顺序排好</strong>，从而减少磁盘头的移动时间</li> <li>充分利用所有空闲内存（<strong>非 JVM 内存</strong>）。如果使用应用层 Cache（即 JVM 堆内存），会增加 GC 负担</li> <li>读操作可直接在 Page Cache 内进行。如果消费和生产速度相当，甚至<strong>不需要通过物理磁盘</strong>（直接通过 Page Cache）交换数据</li> <li>如果<strong>进程重启</strong>，JVM 内的 Cache 会失效，但 <strong>Page Cache 仍然可用</strong></li></ul> <p>尽管持久化到Pagecache上可能会造成宕机丢失数据的情况，但这可以被Kafka的Replication机制解决。如果为了保证这种情况下数据不丢失而强制将 Page Cache 中的数据 Flush 到磁盘，反而会降低性能。</p> <h3 id="零拷贝"><a href="#零拷贝" class="header-anchor">#</a> 零拷贝</h3> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211117172851768.png" alt="image-20211117172851768"></p> <p>从<strong>Page Cache</strong>直接 写到NIC中 <strong>不经过应用层</strong></p> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/v2-dc405f1eb057217aee8820b6d3e340fd_r.jpg" alt="img"></p> <p><strong>零拷贝（Zero-copy）技术，因为我们没有在内存层面去拷贝数据，也就是说全程没有通过 CPU 来搬运数据，所有的数据都是通过 DMA 来进行传输的。</strong></p> <p>零拷贝技术的文件传输方式相比传统文件传输的方式，减少了 2 次上下文切换和数据拷贝次数，<strong>只需要 2 次上下文切换和数据拷贝次数，就可以完成文件的传输，而且 2 次的数据拷贝过程，都不需要通过 CPU，2 次都是由 DMA 来搬运。</strong></p> <p>所以，总体来看，<strong>零拷贝技术可以把文件传输的性能提高至少一倍以上</strong>。</p> <p>事实上，Kafka 这个开源项目，就利用了「零拷贝」技术，从而大幅提升了 I/O 的吞吐率，这也是 Kafka 在处理海量数据为什么这么快的原因之一。</p> <p>如果你追溯 Kafka 文件传输的代码，你会发现，最终它调用了 Java NIO 库里的 <code>transferTo</code> 方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Overridepublic</span> 
<span class="token keyword">long</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span><span class="token class-name">FileChannel</span> fileChannel<span class="token punctuation">,</span> <span class="token keyword">long</span> position<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> fileChannel<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> count<span class="token punctuation">,</span> socketChannel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，要使用 sendfile，Linux 内核版本必须要 2.1 以上的版本。</p> <h2 id="zookeeper在kafka的作用"><a href="#zookeeper在kafka的作用" class="header-anchor">#</a> Zookeeper在Kafka的作用</h2> <p>Kafka集群中有一个broker会被选举为Controller，负责<strong>管理集群broker的上下线</strong>，所有topic的<strong>分区副本分配</strong>和<strong>leader选举</strong>等工作。</p> <p>Controller的管理工作都是依赖于Zookeeper的。</p> <p><img src="https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211117191006739.png" alt="image-20211117191006739"></p> <h2 id="kafka事务"><a href="#kafka事务" class="header-anchor">#</a> Kafka事务</h2> <p>Kafka从0.11版本开始引入了事务支持。事务可以保证Kafka在Exactly Once语义的基础上，生产和消费可以跨分区和会话，要么全部成功，要么全部失败。</p> <h3 id="producer事务"><a href="#producer事务" class="header-anchor">#</a> Producer事务</h3> <p>为了实现跨分区跨会话的事务，需要引入一个<strong>全局唯一的Transaction ID</strong>，并将Producer获得的PID和Transaction ID绑定。这样当Producer重启后就可以通过正在进行的Transaction ID获得原来的PID。</p> <p>为了管理Transaction，Kafka引入了一个新的组件<strong>Transaction Coordinator</strong>。Producer就是通过和Transaction Coordinator交互获得Transaction ID<strong>对应的任务状态</strong>。Transaction Coordinator还负责将事务所有写入Kafka的一个内部Topic，这样即使整个服务重启，由于事务状态得到<strong>保存</strong>，进行中的事务状态可以得到<strong>恢复</strong>，从而<strong>继续进行</strong>。</p> <h3 id="consumer事务-精准一次性消费"><a href="#consumer事务-精准一次性消费" class="header-anchor">#</a> Consumer事务（精准一次性消费）</h3> <p>上述事务机制主要是从Producer方面考虑，对于Consumer而言，事务的保证就会相对较弱，尤其时无法保证Commit的信息被精确消费。这是由于Consumer可以通过offset访问任意信息，而且不同的Segment File生命周期不同，同一事务的消息可能会出现重启后被删除的情况。</p> <p>如果想完成Consumer端的精准一次性消费，<strong>那么需要kafka消费端将消费过程和提交offset过程做原子绑定</strong>。此时我们需要将kafka的offset保存到支持事务的自定义介质中（比如mysql）。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/doc-vuepress/Kafka/命令操作.html" class="prev">
        命令操作
      </a></span> <span class="next"><a href="/doc-vuepress/Kafka/Kafka API.html">
        Kafka API
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/doc-vuepress/assets/js/app.d9f058a2.js" defer></script><script src="/doc-vuepress/assets/js/2.3b3db5cf.js" defer></script><script src="/doc-vuepress/assets/js/143.2226636a.js" defer></script>
  </body>
</html>
