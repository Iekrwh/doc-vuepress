(window.webpackJsonp=window.webpackJsonp||[]).push([[142],{509:function(s,a,t){"use strict";t.r(a);var e=t(46),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"kafka-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-安装"}},[s._v("#")]),s._v(" Kafka 安装")]),s._v(" "),t("p",[s._v("Kafka 不依赖于hadoop运作  "),t("strong",[s._v("只依赖zookeeper运行")])]),s._v(" "),t("p",[s._v("要先事先安装好zookeeper 并运行")]),s._v(" "),t("p",[s._v("http://kafka.apache.org/downloads")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf kafka_2.11-2.4.1.tgz -C /opt/module/\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" kafka_2.11-2.4.1/ kafka\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" kafka\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" logs\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#环境变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/profile.d/my_env.sh\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#KAFKA_HOME")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KAFKA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/module/kafka\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KAFKA_HOME")]),s._v("/bin\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile.d/my_env.sh\n")])])]),t("p",[s._v("配置kafka")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /opt/module/kafka/config/server.properties\n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#broker的全局唯一编号，不能重复")]),s._v("\nbroker.id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除topic功能使能")]),s._v("\ndelete.topic.enable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#处理网络请求的线程数量")]),s._v("\nnum.network.threads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用来处理磁盘IO的现成数量")]),s._v("\nnum.io.threads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发送套接字的缓冲区大小")]),s._v("\nsocket.send.buffer.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#接收套接字的缓冲区大小")]),s._v("\nsocket.receive.buffer.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#请求套接字的缓冲区大小")]),s._v("\nsocket.request.max.bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("104857600")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#kafka运行日志存放的路径")]),s._v("\nlog.dirs"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/module/kafka/logs\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#topic在当前broker上的分区个数")]),s._v("\nnum.partitions"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用来恢复和清理data下数据的线程数量")]),s._v("\nnum.recovery.threads.per.data.dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#segment文件保留的最长时间，超时将被删除")]),s._v("\nlog.retention.hours"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("168")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置连接Zookeeper集群地址")]),s._v("\nzookeeper.connect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hadoop102:2181,hadoop103:2181,hadoop104:2181/kafka\n")])])]),t("p",[s._v("分发环境变量和kafka")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" xsync /opt/module/kafka \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" xsync /etc/profile.d/my_env.sh\n")])])]),t("p",[s._v("修改每个kafka中 broker.id")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /opt/module/kafka/config/server.properties\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#102 为 2, 103为3  , 104为4")]),s._v("\n")])])]),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kafka-server-start.sh -daemon "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KAFKA_HOME")]),s._v("/config/server.properties "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每台机器单独起")]),s._v("\n\nkafka-server-stop.sh "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭")]),s._v("\n")])])]),t("p",[s._v("群起脚本  "),t("strong",[s._v("记得先启动zookeeper")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /bin/kafkalist.sh\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /opt/module/hadoop-3.1.3/etc/hadoop/workers"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"========== '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(' =========="')]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'kafka-server-start.sh -daemon $KAFKA_HOME/config/server.properties'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /bin/kafkalist.sh\n")])])]),t("p",[s._v("如果遇kafka闪退 可以尝试删除logs文件夹下的内容")]),s._v(" "),t("p",[s._v("查看zookeeper中是否有kafka id已经记录")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("zkCli.sh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /kafka/brokers/ids\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);