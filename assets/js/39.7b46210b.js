(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{410:function(t,s,a){"use strict";a.r(s);var e=a(46),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"压缩和存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#压缩和存储"}},[t._v("#")]),t._v(" 压缩和存储")]),t._v(" "),a("h2",{attrs:{id:"压缩参数设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#压缩参数设置"}},[t._v("#")]),t._v(" 压缩参数设置")]),t._v(" "),a("p",[t._v("要在Hadoop中启用压缩，可以配置如下参数（mapred-site.xml文件中）：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("默认值")]),t._v(" "),a("th",[t._v("阶段")]),t._v(" "),a("th",[t._v("建议")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("io.compression.codecs    （在core-site.xml中配置）")]),t._v(" "),a("td",[t._v("org.apache.hadoop.io.compress.DefaultCodec,  org.apache.hadoop.io.compress.GzipCodec,  org.apache.hadoop.io.compress.BZip2Codec,  org.apache.hadoop.io.compress.Lz4Codec")]),t._v(" "),a("td",[t._v("输入压缩")]),t._v(" "),a("td",[t._v("Hadoop使用文件扩展名判断是否支持某种编解码器")])]),t._v(" "),a("tr",[a("td",[t._v("mapreduce.map.output.compress")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("mapper输出")]),t._v(" "),a("td",[t._v("这个参数设为true启用压缩")])]),t._v(" "),a("tr",[a("td",[t._v("mapreduce.map.output.compress.codec")]),t._v(" "),a("td",[t._v("org.apache.hadoop.io.compress.DefaultCodec")]),t._v(" "),a("td",[t._v("mapper输出")]),t._v(" "),a("td",[t._v("使用LZO、LZ4或snappy编解码器在此阶段压缩数据")])]),t._v(" "),a("tr",[a("td",[t._v("mapreduce.output.fileoutputformat.compress")]),t._v(" "),a("td",[t._v("false")]),t._v(" "),a("td",[t._v("reducer输出")]),t._v(" "),a("td",[t._v("这个参数设为true启用压缩")])]),t._v(" "),a("tr",[a("td",[t._v("mapreduce.output.fileoutputformat.compress.codec")]),t._v(" "),a("td",[t._v("org.apache.hadoop.io.compress. DefaultCodec")]),t._v(" "),a("td",[t._v("reducer输出")]),t._v(" "),a("td",[t._v("使用标准工具或者编解码器，如gzip和bzip2")])]),t._v(" "),a("tr",[a("td",[t._v("mapreduce.output.fileoutputformat.compress.type")]),t._v(" "),a("td",[t._v("RECORD")]),t._v(" "),a("td",[t._v("reducer输出")]),t._v(" "),a("td",[t._v("SequenceFile输出使用的压缩类型：NONE和BLOCK")])])])]),t._v(" "),a("h2",{attrs:{id:"开启map输出阶段压缩-mr引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启map输出阶段压缩-mr引擎"}},[t._v("#")]),t._v(" 开启map输出阶段压缩(MR引擎)")]),t._v(" "),a("p",[t._v("临时开启")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" hive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("intermediate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 开启hive中间传送的压缩功能")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" mapreduce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 开启mapreduce中map输出压缩功能")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" mapreduce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("codec"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SnappyCodec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 设置指定的压缩方式")]),t._v("\n")])])]),a("h2",{attrs:{id:"开启reduce输出阶段压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启reduce输出阶段压缩"}},[t._v("#")]),t._v(" 开启Reduce输出阶段压缩")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" hive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 开启hive最终输出数据压缩")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" mapreduce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fileoutputformat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 开启mapreduce最终输出数据压缩")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" mapreduce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fileoutputformat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("codec "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hadoop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SnappyCodec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 设置压缩方式")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" mapreduce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("output"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fileoutputformat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("BLOCK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 设置mapreduce最终输出压缩方式")]),t._v("\n")])])]),a("h2",{attrs:{id:"文件存储格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件存储格式"}},[t._v("#")]),t._v(" 文件存储格式")]),t._v(" "),a("p",[t._v("Hive支持的存储数据的格式主要有：")]),t._v(" "),a("p",[t._v("行存储 TEXTFILE 、SEQUENCEFILE")]),t._v(" "),a("p",[t._v("列存储 ORC、PARQUET  "),a("strong",[t._v("Hive中使用列存储比较好")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211109185028034.png",alt:"image-20211109185028034"}})]),t._v(" "),a("h2",{attrs:{id:"textfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#textfile"}},[t._v("#")]),t._v(" TEXTFILE")]),t._v(" "),a("p",[t._v("默认格式，数据不做压缩，磁盘开销大，数据解析开销大。可结合Gzip、Bzip2使用，但使用Gzip这种方式，hive不会对数据进行切分，从而无法对数据进行并行操作。")]),t._v(" "),a("h2",{attrs:{id:"orc格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#orc格式"}},[t._v("#")]),t._v(" Orc格式")]),t._v(" "),a("p",[t._v("Orc文件由1个或多个stripe组成，每个stripe一般为HDFS的块大小，每一个stripe包含多条记录，这些记录按照列进行独立存储，对应到Parquet中的row group的概念。每个Stripe里有三部分组成，分别是Index Data，Row Data，Stripe Footer：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211109185329421.png",alt:"image-20211109185329421"}})]),t._v(" "),a("p",[t._v("1）Index Data：一个轻量级的index，默认是每隔1W行做一个索引。这里做的索引应该只是记录某行的各字段在Row Data中的offset。")]),t._v(" "),a("p",[t._v("2）Row Data：存的是具体的数据，先取部分行，然后对这些行按列进行存储。对每个列进行了编码，分成多个Stream来存储。")]),t._v(" "),a("p",[t._v("3）Stripe Footer：存的是各个Stream的类型，长度等信息。")]),t._v(" "),a("p",[t._v("每个文件有一个File Footer，这里面存的是每个Stripe的行数，每个Column的数据类型信息等；每个文件的尾部是一个PostScript，这里面记录了整个文件的压缩类型以及FileFooter的长度信息等。在读取文件时，会seek到文件尾部读PostScript，从里面解析到File Footer长度，再读FileFooter，从里面解析到各个Stripe信息，再读各个Stripe，即从后往前读。")]),t._v(" "),a("h2",{attrs:{id:"parquet格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parquet格式"}},[t._v("#")]),t._v(" Parquet格式")]),t._v(" "),a("p",[t._v("Parquet文件是以二进制方式存储的，所以是不可以直接读取的，文件中包括该文件的数据和元数据，因此Parquet格式文件是自解析的。")]),t._v(" "),a("p",[t._v("（1）行组(Row Group)：每一个行组包含一定的行数，在一个HDFS文件中至少存储一个行组，类似于orc的stripe的概念。")]),t._v(" "),a("p",[t._v("（2）列块(Column Chunk)：在一个行组中每一列保存在一个列块中，行组中的所有列连续的存储在这个行组文件中。一个列块中的值都是相同类型的，不同的列块可能使用不同的算法进行压缩。")]),t._v(" "),a("p",[t._v("（3）页(Page)：每一个列块划分为多个页，一个页是最小的编码的单位，在同一个列块的不同页可能使用不同的编码方式。")]),t._v(" "),a("h2",{attrs:{id:"指定文件存储格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定文件存储格式"}},[t._v("#")]),t._v(" 指定文件存储格式")]),t._v(" "),a("h3",{attrs:{id:"textfile-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#textfile-2"}},[t._v("#")]),t._v(" textfile")]),t._v(" "),a("p",[t._v("在建表时通过stored 关键字指定格式")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" log_text "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\ntrack_time string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nurl string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsession_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nreferer string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nip string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nend_user_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ncity_id string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("row")]),t._v(" format delimited "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fields")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("terminated")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\t'")]),t._v("\nstored "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" textfile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 指定为textfile 默认也是textfile")]),t._v("\n")])])]),a("h3",{attrs:{id:"orc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#orc"}},[t._v("#")]),t._v(" orc")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" log_orc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\ntrack_time string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nurl string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsession_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nreferer string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nip string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nend_user_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ncity_id string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("row")]),t._v(" format delimited "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fields")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("terminated")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\t'")]),t._v("\nstored "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" orc  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 指定为orc格式")]),t._v("\ntblproperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orc.compress"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NONE"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 去掉压缩")]),t._v("\n")])])]),a("p",[t._v("只能插入数据 不能直接加数据文件")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" log_orc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" log_text "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"parquet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parquet"}},[t._v("#")]),t._v(" parquet")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" log_parquet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\ntrack_time string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nurl string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsession_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nreferer string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nip string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nend_user_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ncity_id string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("row")]),t._v(" format delimited "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fields")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("terminated")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\t'")]),t._v("\nstored "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" parquet "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("插入数据")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" log_parquet "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" log_text "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"三种存储格式大小比较"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三种存储格式大小比较"}},[t._v("#")]),t._v(" 三种存储格式大小比较")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211109190508464.png",alt:"image-20211109190508464"}})]),t._v(" "),a("h2",{attrs:{id:"存储和压缩结合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储和压缩结合"}},[t._v("#")]),t._v(" 存储和压缩结合")]),t._v(" "),a("h3",{attrs:{id:"orc存储方式的压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#orc存储方式的压缩"}},[t._v("#")]),t._v(" orc存储方式的压缩")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Key")]),t._v(" "),a("th",[t._v("Default")]),t._v(" "),a("th",[t._v("Notes")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("orc.compress")]),t._v(" "),a("td",[t._v("ZLIB")]),t._v(" "),a("td",[t._v("high level  compression (one of NONE, ZLIB, SNAPPY)")])]),t._v(" "),a("tr",[a("td",[t._v("orc.compress.size")]),t._v(" "),a("td",[t._v("262,144")]),t._v(" "),a("td",[t._v("number of bytes  in each compression chunk")])]),t._v(" "),a("tr",[a("td",[t._v("orc.stripe.size")]),t._v(" "),a("td",[t._v("268,435,456")]),t._v(" "),a("td",[t._v("number of bytes in each stripe")])]),t._v(" "),a("tr",[a("td",[t._v("orc.row.index.stride")]),t._v(" "),a("td",[t._v("10,000")]),t._v(" "),a("td",[t._v("number of rows between index entries (must be >= 1000)")])]),t._v(" "),a("tr",[a("td",[t._v("orc.create.index")]),t._v(" "),a("td",[t._v("true")]),t._v(" "),a("td",[t._v("whether to create  row indexes")])]),t._v(" "),a("tr",[a("td",[t._v("orc.bloom.filter.columns")]),t._v(" "),a("td",[t._v('""')]),t._v(" "),a("td",[t._v("comma separated list of column names for which bloom filter should be  created")])]),t._v(" "),a("tr",[a("td",[t._v("orc.bloom.filter.fpp")]),t._v(" "),a("td",[t._v("0.05")]),t._v(" "),a("td",[t._v("false positive probability for bloom filter (must >0.0 and <1.0)")])])])]),t._v(" "),a("p",[t._v("所有关于ORCFile的参数都是在HQL语句的TBLPROPERTIES字段里面出现  在建表时指定")]),t._v(" "),a("h4",{attrs:{id:"zlib压缩格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zlib压缩格式"}},[t._v("#")]),t._v(" ZLIB压缩格式")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" log_zlib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\ntrack_time string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nurl string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsession_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nreferer string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nip string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nend_user_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ncity_id string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("row")]),t._v(" format delimited "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fields")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("terminated")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\t'")]),t._v("\nstored "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" orc  \ntblproperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orc.compress"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ZLIB"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 指定压缩为ZLIB 默认也为ZLIB")]),t._v("\n")])])]),a("p",[t._v("插入数据")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" log_orc_zlib "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" log_text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"snappy压缩格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#snappy压缩格式"}},[t._v("#")]),t._v(" SNAPPY压缩格式")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" log_orc_snappy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\ntrack_time string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nurl string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsession_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nreferer string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nip string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nend_user_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ncity_id string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("row")]),t._v(" format delimited "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fields")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("terminated")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\t'")]),t._v("\nstored "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" orc\ntblproperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orc.compress"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SNAPPY"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("插入数据")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" log_orc_snappy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" log_text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"压缩后文件大小比较"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#压缩后文件大小比较"}},[t._v("#")]),t._v(" 压缩后文件大小比较")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211109191148903.png",alt:"image-20211109191148903"}})]),t._v(" "),a("h3",{attrs:{id:"parquet存储方式的压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parquet存储方式的压缩"}},[t._v("#")]),t._v(" Parquet存储方式的压缩")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" log_par_snappy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\ntrack_time string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nurl string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nsession_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nreferer string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nip string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nend_user_id string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\ncity_id string\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("row")]),t._v(" format delimited "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fields")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("terminated")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\t'")]),t._v("\nstored "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" parquet\ntblproperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"parquet.compression"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SNAPPY"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" log_par_snappy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" log_text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211109191516349.png",alt:"image-20211109191516349"}})]),t._v(" "),a("p",[t._v("未压缩和压缩之后文件大小")]),t._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("在实际的项目开发当中，hive表的数据存储格式一般选择：orc或parquet。压缩方式一般选择snappy，lzo。")])])}),[],!1,null,null,null);s.default=r.exports}}]);