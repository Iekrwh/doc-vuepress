(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{405:function(t,s,a){"use strict";a.r(s);var n=a(46),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"elasticsearch-高级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-高级"}},[t._v("#")]),t._v(" ElasticSearch 高级")]),t._v(" "),a("h2",{attrs:{id:"批量操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#批量操作"}},[t._v("#")]),t._v(" 批量操作")]),t._v(" "),a("p",[t._v("Bulk 批量操作是将文档的增删改查一系列操作 通过一次请求 全部完成 减少网络传输次数")]),t._v(" "),a("h3",{attrs:{id:"脚本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本操作"}},[t._v("#")]),t._v(" 脚本操作")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[t._v("GET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 批量操作")]),t._v("\nPOST _bulk\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"delete"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"_index"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"person"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('"_id"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"'),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v('"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"create"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"_index"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"person"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('"_id"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"'),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v('"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"hhh"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('"age"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("88")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('"address"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"qqqq"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"update"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"_index"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"person"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('"_id"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"'),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v('"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"doc"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"qwedqd"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api"}},[t._v("#")]),t._v(" API")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//批量操作 bulk")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testBulk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建bulkrequest对象 整合所有操作")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BulkRequest")]),t._v(" bulkRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BulkRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//添加操作")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//删除1号操作")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeleteRequest")]),t._v(" deleteRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DeleteRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    bulkRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deleteRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//添加6号操作")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),t._v(" map "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IndexRequest")]),t._v(" indexRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IndexRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    bulkRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("indexRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//修改3号操作")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),t._v(" map2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    map2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试3号"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UpdateRequest")]),t._v(" updateReqeust "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UpdateRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("doc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    bulkRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updateReqeust"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//执行批量操作")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BulkResponse")]),t._v(" response "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bulk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bulkRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestStatus")]),t._v(" status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"导入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入数据"}},[t._v("#")]),t._v(" 导入数据")]),t._v(" "),a("p",[t._v("将数据库中表数据导入到ElasticSearch中")]),t._v(" "),a("ol",[a("li",[t._v("创建索引 并添加mapping")]),t._v(" "),a("li",[t._v("创建pojo类 映射mybatis")]),t._v(" "),a("li",[t._v("查询数据库")]),t._v(" "),a("li",[t._v("使用Bulk  批量导入")])]),t._v(" "),a("h3",{attrs:{id:"使用fastjson-转换对象不转换该成员变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用fastjson-转换对象不转换该成员变量"}},[t._v("#")]),t._v(" 使用fastjson 转换对象不转换该成员变量")]),t._v(" "),a("p",[t._v("在成员变量加上注解  使用@JSONField(serialize =false) 此成员变量不参与json转换")]),t._v(" "),a("h2",{attrs:{id:"matchall查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#matchall查询"}},[t._v("#")]),t._v(" matchALL查询")]),t._v(" "),a("p",[t._v("matchALL查询 查询所有文档")]),t._v(" "),a("h3",{attrs:{id:"脚本操作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本操作-2"}},[t._v("#")]),t._v(" 脚本操作")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认情况下,es一次只展示10条数据  通过from控制页码 size控制每页展示条数")]),t._v("\n\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "match_all"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n  "from"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n  "size"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211009201735964.png",alt:"image-20211009201735964"}})]),t._v(" "),a("h3",{attrs:{id:"api操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api操作"}},[t._v("#")]),t._v(" Api操作")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//matchall查询所有 分页操作")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testMatchALL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//2通过索引查询")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//4创建查询条件构建器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBuilder "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//5查询条件")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilder")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("matchAllQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//查询所有文档")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//6指定查询条件")]),t._v("\n    sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//分页查询")]),t._v("\n    sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//第几页")]),t._v("\n    sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//每页显示数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//3添加查询条件构建器")]),t._v("\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1查询 获取查询结果")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//7获取命中对象 hits")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"term查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#term查询"}},[t._v("#")]),t._v(" term查询")]),t._v(" "),a("h3",{attrs:{id:"脚本查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本查询"}},[t._v("#")]),t._v(" 脚本查询")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# term查询 词条查询 一般用于查分类")]),t._v("\n\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "term"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "value"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "hhh"\n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"api查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api查询"}},[t._v("#")]),t._v(" api查询")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//termQuery 词条查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testTermQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBulider"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilder")]),t._v(" query"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("termQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hhh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"match查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#match查询"}},[t._v("#")]),t._v(" match查询")]),t._v(" "),a("ul",[a("li",[t._v("会对查询条件进行分词")]),t._v(" "),a("li",[t._v("然后将分词后的查询条件和词条进行等值匹配")]),t._v(" "),a("li",[t._v("默认取并集(OR)  交集为(AND)")])]),t._v(" "),a("h3",{attrs:{id:"脚本操作-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本操作-3"}},[t._v("#")]),t._v(" 脚本操作")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# match 查询")]),t._v("\n\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "match"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "hhh"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n        "operator"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "or"\n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"api操作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api操作-2"}},[t._v("#")]),t._v(" API操作")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//match 词条查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testMatchQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBulider"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MatchQueryBuilder")]),t._v(" query"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("matchQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hhh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//并集")]),t._v("\n\n    sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"模糊查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模糊查询"}},[t._v("#")]),t._v(" 模糊查询")]),t._v(" "),a("ul",[a("li",[t._v("wildcard查询  会对查询条件进行分词 可以使用通配符 ?(任意单个字符) 和 * (0或多个字符)")]),t._v(" "),a("li",[t._v("regexp 查询  正则查询")]),t._v(" "),a("li",[t._v("prefix 前缀查询")])]),t._v(" "),a("h3",{attrs:{id:"脚本查询-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本查询-2"}},[t._v("#")]),t._v(" 脚本查询")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# wildcard 查询 查询条件分词 模糊查询")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "wildcard"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "value"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "h"\n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 正则查询 查询条件分词 模糊查询")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "regexp"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "'),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("\\")]),t._v("q"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token dyadic-operator operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("*")]),t._v('"\n    '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 前缀查询")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "prefix"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "value"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "qwe"\n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"api操作-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api操作-3"}},[t._v("#")]),t._v(" api操作")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//wildcard 模糊查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testWildcardQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBulider"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WildcardQueryBuilder")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wildcardQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//regexp  正则查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testrRegexpQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBulider"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RegexpQueryBuilder")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("regexpQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\\\h*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//prefix   前缀查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testrPrefixQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBulider"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PrefixQueryBuilder")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("prefixQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"qwe"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"范围查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范围查询"}},[t._v("#")]),t._v(" 范围查询")]),t._v(" "),a("p",[t._v("range范围查询 查询指定字段在指定范围内包含值")]),t._v(" "),a("h3",{attrs:{id:"脚本查询-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本查询-3"}},[t._v("#")]),t._v(" 脚本查询")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("#")]),t._v("范围查询\nGET perso"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "range"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "age"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "gte"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n        "lte"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n  "sort"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "age"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "order"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "desc"\n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"api查询-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api查询-2"}},[t._v("#")]),t._v(" api查询")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//range   范围查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testRangeQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBulider"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RangeQueryBuilder")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rangeQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//指定字段")]),t._v("\n    query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("gte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"10"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//小于等于")]),t._v("\n    query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"30"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//大于等于")]),t._v("\n\n\n    sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SortOrder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ASC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//排序")]),t._v("\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"querystring查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#querystring查询"}},[t._v("#")]),t._v(" queryString查询")]),t._v(" "),a("ul",[a("li",[t._v("会对查询条件进行分词")]),t._v(" "),a("li",[t._v("然后将分词后的查询条件和词条进行等值匹配")]),t._v(" "),a("li",[t._v("默认取并集")]),t._v(" "),a("li",[t._v("可以指定多个查询字段")])]),t._v(" "),a("h3",{attrs:{id:"脚本查询-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本查询-4"}},[t._v("#")]),t._v(" 脚本查询")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# queryString 查询")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "query_string"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "fields"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v('"name"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('"address"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n      "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "华为 OR 手机"\n    '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SimpleQueryStringQuery是QueryStringQuery的简化版，其本身不支持 AND OR NOT 布尔运算关键字，这些关键字会被当做普通词语进行处理。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以通过 default_operator 指定查询字符串默认使用的运算方式，默认为 OR")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "simple_query_string"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "fields"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v('"name"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('"address"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n      "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "华为 OR 手机"\n    '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"api查询-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api查询-3"}},[t._v("#")]),t._v(" Api查询")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//queryString")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testQueryStringQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBulider"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryStringQueryBuilder")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("queryStringQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"华为"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"address"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultOperator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBulider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"布尔查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#布尔查询"}},[t._v("#")]),t._v(" 布尔查询")]),t._v(" "),a("p",[t._v("boolQuery 对多个查询条件连接 组合查询")]),t._v(" "),a("ul",[a("li",[t._v("must (and) 条件必须成立")]),t._v(" "),a("li",[t._v("must_not (not) 条件必须不成立")]),t._v(" "),a("li",[t._v("should(or) 条件可以成立")]),t._v(" "),a("li",[t._v("filter 条件必须成功 性能比must高 不会计算得分 (当查询结果符合查询条件越多则得分越多)")])]),t._v(" "),a("h3",{attrs:{id:"脚本查询-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本查询-5"}},[t._v("#")]),t._v(" 脚本查询")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bool查询")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "bool"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "must"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"term"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n          "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n            "value"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "张三"\n          '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("#")]),t._v("filter\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "bool"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "filter"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"term"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n          "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n            "value"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "张三"\n          '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 组合多条件查询")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "bool"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "must"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('"term"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n          "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n            "value"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "张三"\n          '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n      "filter"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n          "term"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n            "address"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "'),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v('G"\n          '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\n\n")])])]),a("h3",{attrs:{id:"api查询-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api查询-4"}},[t._v("#")]),t._v(" API查询")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//boolQuery")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testBoolQueryQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBuilder"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//构建boolQuery")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BoolQueryBuilder")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("boolQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//构建各个查询条件")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TermQueryBuilder")]),t._v(" termQuery "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("termQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//查询名字为张三的")]),t._v("\n    query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("must")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("termQuery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MatchQueryBuilder")]),t._v(" matchQuery "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("matchQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"address"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5G"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//查询地址包含5g的")]),t._v("\n    query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("must")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("matchQuery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"聚合查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#聚合查询"}},[t._v("#")]),t._v(" 聚合查询")]),t._v(" "),a("ul",[a("li",[t._v("指标聚合 相当于mysql的聚合函数 max min avg sum等")]),t._v(" "),a("li",[t._v("桶聚合 相当于mysql的group by . 不要对text类型的数据进行分组 会失败")])]),t._v(" "),a("h3",{attrs:{id:"脚本查询-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本查询-6"}},[t._v("#")]),t._v(" 脚本查询")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 聚合查询")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指标聚合 聚合函数")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "match"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "张三"\n    '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n  "aggs"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "NAME"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "max"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "field"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "age" \n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 桶聚合 分组  通过 aggs")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "match"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "name"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "张三"\n    '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n  "aggs"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "zdymc"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "terms"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "field"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "age"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n        "size"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211010141610400.png",alt:"image-20211010141610400"}})]),t._v(" "),a("h3",{attrs:{id:"api查询-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api查询-5"}},[t._v("#")]),t._v(" Api查询")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//聚合查询 桶聚合 分组")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testAggsQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBuilder"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MatchQueryBuilder")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("matchQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * terms 查询后结果名称\n     * field 条件字段\n     * size 每页展示的条数\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TermsAggregationBuilder")]),t._v(" aggs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AggregationBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("terms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"自定义名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("aggregation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("aggs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取聚合结果")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Aggregations")]),t._v(" aggregations "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAggregations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Aggregation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" aggregationMap "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" aggregations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("asMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将结果转为map")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Terms")]),t._v(" zdymc "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Terms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" aggregationMap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"自定义名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Terms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Bucket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" buckets "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zdymc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBuckets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),t._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Terms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Bucket")]),t._v(" bucket "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" buckets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" key "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bucket"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" o "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"高亮查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高亮查询"}},[t._v("#")]),t._v(" 高亮查询")]),t._v(" "),a("ul",[a("li",[t._v("高亮字段")]),t._v(" "),a("li",[t._v("前缀")]),t._v(" "),a("li",[t._v("后缀  如果不设置前后缀 默认为em标签")])]),t._v(" "),a("h3",{attrs:{id:"脚本操作-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脚本操作-4"}},[t._v("#")]),t._v(" 脚本操作")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 高亮查询")]),t._v("\nGET person"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "query"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "match"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "address"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "手机"\n    '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n  "highlight"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "fields"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "address"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "pre_tags"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("<")]),t._v("font color"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'red'")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(">")]),t._v('"'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n        "post_tags"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "'),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("font"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(">")]),t._v('"\n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  \n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"api操作-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api操作-4"}},[t._v("#")]),t._v(" Api操作")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//highlight 高亮查询")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("testHighlightQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),t._v(" searchRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"person"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),t._v(" sourceBuilder"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchSourceBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MatchQueryBuilder")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryBuilders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("matchQuery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"address"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"手机"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HighlightBuilder")]),t._v(" highlightBuilder "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HighlightBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//高亮对象")]),t._v("\n    highlightBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("field")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"address"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//字段")]),t._v("\n    highlightBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("preTags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"<font color='red'>\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//前缀")]),t._v("\n    highlightBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postTags")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"</font>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//后缀")]),t._v("\n    sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("highlighter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("highlightBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceBuilder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchResponse")]),t._v(" search "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restHighLevelClient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("search")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("searchRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHits")]),t._v(" searchHits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" search"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取总条数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"总记录数"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取hits数组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hits "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" searchHits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SearchHit")]),t._v(" hit "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" hits"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sourceAsString "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSourceAsString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取json字符串格式的数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//todo 将对象转为json")]),t._v("\n\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HighlightField")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" highlightFields "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHighlightFields")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取高亮中的对象元素")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HighlightField")]),t._v(" address "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" highlightFields"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"address"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" fragments "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" address"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fragments")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取元素中的高亮数组结果")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//替换json中的成员变量数据")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//todo")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sourceAsString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Arrays")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fragments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"重建索引-索引别名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重建索引-索引别名"}},[t._v("#")]),t._v(" 重建索引&索引别名")]),t._v(" "),a("p",[t._v("ES的索引一旦创建,只允许添加字段 不允许改变字段 因为改变字段 需要重建倒排索引 影响内部缓存结构")]),t._v(" "),a("p",[t._v("此时需要重建一个新的索引 并将原有索引的数据导入到新索引中")]),t._v(" "),a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重建索引")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 新建索引 索引名称必须全部小写")]),t._v("\nPUT stdent_index_v1\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "mappings"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "properties"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "birthday"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "type"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "date"\n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\nGET stdent_index_v1\n\nPUT stdent_index_v1"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_doc"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "birthday"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"'),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1999")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("01")]),t._v('"\n'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\nGET stdent_index_v1"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 现在stdent_index_v1需要存储birthday为一个字符串")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.创建新的索引v2")]),t._v("\nPUT stdent_index_v2\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "mappings"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "properties"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "birthday"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "type"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "text"\n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token dyadic-operator operator"}},[t._v(".")]),t._v("将旧索引的数据拷贝到新索引 使用_reindex\nPOST _reindex\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "source"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "index"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "stdent_index_v1"\n  '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n  "dest"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "index"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "stdent_index_v2"\n  '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\n\nGET stdent_index_v2"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_search\n\n\nPUT stdent_index_v2"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_doc"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "birthday"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v('"'),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("199")]),t._v("年"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("124")]),t._v('日"\n'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 索引别名  因为旧索引已经不使用 而我们代码中写的是旧索引名 无法正常运行 则需要别名")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.删除旧索引")]),t._v("\nDELETE stdent_index_v1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2. 给新索引起别名为旧索引名")]),t._v("\nPOST stdent_index_v2"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("_alias"),a("span",{pre:!0,attrs:{class:"token monadic-operator operator"}},[t._v("/")]),t._v("stdent_index_v1\n")])])]),a("h2",{attrs:{id:"es集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#es集群"}},[t._v("#")]),t._v(" ES集群")]),t._v(" "),a("p",[t._v("ES天然支持分布式,并且分布式自动配置")]),t._v(" "),a("ul",[a("li",[t._v("集群(cluster) 一组拥有共同的cluster name 节点")]),t._v(" "),a("li",[t._v("节点(node) 集合中的一个ES实例")]),t._v(" "),a("li",[t._v("索引(index)  es存储数据的地方")]),t._v(" "),a("li",[t._v("分片(shard) 索引可以被拆分为不同的部分进行存储 称为分片  在集群环境下 一个索引的不同可以拆分到不同节点中")]),t._v(" "),a("li",[t._v("主分片(Primary shard)  相当于副本分片的定义")]),t._v(" "),a("li",[t._v("副本分片 每个主分片可以有一个或多个副本 数据与主分片一样")])]),t._v(" "),a("h3",{attrs:{id:"搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建"}},[t._v("#")]),t._v(" 搭建")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("准备3个集群 此处作伪集群 使用端口号区分")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -r elasticsearch-7.15.0 elasticsearch-7.15.0-1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -r elasticsearch-7.15.0 elasticsearch-7.15.0-2\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -r elasticsearch-7.15.0 elasticsearch-7.15.0-3\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建日志和data目录 并授权给iekr用户")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" logs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" data\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#授权")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R iekr:iekr ./logs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R iekr:iekr ./data\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R iekr:iekr ./elasticsearch-7.15.0-1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R iekr:iekr ./elasticsearch-7.15.0-2\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R iekr:iekr ./elasticsearch-7.15.0-3\n\n")])])])]),t._v(" "),a("li",[a("p",[t._v("修改三个集群的配置文件")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /opt/elasticsearch-7.15.0-1/config/elasticsearch.yml\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群名称  各个集群必须一致")]),t._v("\ncluster.name: itcast-es\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 节点名称  不能一致")]),t._v("\nnode.name: iekr-1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#是否有资格主节点")]),t._v("\nnode.master: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#是否存储数据")]),t._v("\nnode.data: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最大集群数")]),t._v("\nnode.max_local_storage_nodes: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ip地址")]),t._v("\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口")]),t._v("\nhttp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9201")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#内部节点之间沟通端口")]),t._v("\ntransport.tcp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9700")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#节点发现 es7.x才有")]),t._v("\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9700"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9800"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9900"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#初始化一个新的集群时需要此配置来选举master")]),t._v("\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iekr-1"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iekr-2"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iekr-3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#数据和存储路径")]),t._v("\npath.data: /opt/data\npath.logs: /opt/logs\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /opt/elasticsearch-7.15.0-2/config/elasticsearch.yml\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群名称  各个集群必须一致")]),t._v("\ncluster.name: itcast-es\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 节点名称  不能一致")]),t._v("\nnode.name: iekr-2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#是否有资格主节点")]),t._v("\nnode.master: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#是否存储数据")]),t._v("\nnode.data: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最大集群数")]),t._v("\nnode.max_local_storage_nodes: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ip地址")]),t._v("\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口")]),t._v("\nhttp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9202")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#内部节点之间沟通端口")]),t._v("\ntransport.tcp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9800")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#节点发现 es7.x才有")]),t._v("\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9700"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9800"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9900"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#初始化一个新的集群时需要此配置来选举master")]),t._v("\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iekr-1"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iekr-2"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iekr-3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#数据和存储路径")]),t._v("\npath.data: /opt/data\npath.logs: /opt/logs\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /opt/elasticsearch-7.15.0-3/config/elasticsearch.yml\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群名称  各个集群必须一致")]),t._v("\ncluster.name: itcast-es\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 节点名称  不能一致")]),t._v("\nnode.name: iekr-3\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#是否有资格主节点")]),t._v("\nnode.master: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#是否存储数据")]),t._v("\nnode.data: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最大集群数")]),t._v("\nnode.max_local_storage_nodes: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ip地址")]),t._v("\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口")]),t._v("\nhttp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9203")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#内部节点之间沟通端口")]),t._v("\ntransport.tcp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9900")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#节点发现 es7.x才有")]),t._v("\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9700"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9800"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9900"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#初始化一个新的集群时需要此配置来选举master")]),t._v("\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iekr-1"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iekr-2"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iekr-3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#数据和存储路径")]),t._v("\npath.data: /opt/data\npath.logs: /opt/logs\n")])])])]),t._v(" "),a("li",[a("p",[t._v("ES默认占用1G  我们通过配置文件修改")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /opt/elasticsearch-7.15.0-1/config/jvm.options\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("-Xms256m\n-Xmx256m\n")])])])]),t._v(" "),a("li",[a("p",[t._v("分别启动")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("systemctl stop firewalld\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" iekr\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/elasticsearch-7.15.0-1/bin/\n./elasticsearch\n")])])])]),t._v(" "),a("li",[a("p",[t._v("访问 http://192.168.130.124:9201/_cat/health?v 节点状态")])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211010154929625.png",alt:"image-20211010154929625"}})]),t._v(" "),a("h3",{attrs:{id:"使用kibana配置和管理集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用kibana配置和管理集群"}},[t._v("#")]),t._v(" 使用Kibana配置和管理集群")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("复制kibana")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -r kibana-7.15.0-linux-x86_64 kibana-7.15.0-linux-x86_64-cluster\n")])])])]),t._v(" "),a("li",[a("p",[t._v("修改kibana集群配置")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /opt/kibana-7.15.0-linux-x86_64-cluster/config/kibana.yml\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改以下内容")]),t._v("\nelasticsearch.hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:9201"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:9202"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:9203"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("启动")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/kibana-7.15.0-linux-x86_64-cluster/bin/\n./kibana --allow-root\n")])])])]),t._v(" "),a("li",[a("p",[t._v("访问 http://192.168.130.124:5601/app/monitoring 查询集群节点信息")])])]),t._v(" "),a("h3",{attrs:{id:"javaapi访问集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#javaapi访问集群"}},[t._v("#")]),t._v(" JavaApi访问集群")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("application.yml")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("elasticsearch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.130.124\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9201")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.130.124\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9202")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.130.124\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9203")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("config类 并注册ioc容器")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itheima"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elasticsearchdemo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elasticsearch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestHighLevelClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("properties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConfigurationProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ConfigurationProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prefix "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"elasticsearch"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElasticSearchConfig")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" host2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" port2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" host3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" port3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("host "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestHighLevelClient")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestHighLevelClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("port2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("port3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"集群原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群原理"}},[t._v("#")]),t._v(" 集群原理")]),t._v(" "),a("h4",{attrs:{id:"分片配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分片配置"}},[t._v("#")]),t._v(" 分片配置")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("在创建索引时 如果不指定分配配置 默认主分片1  副本分片1")]),t._v(" "),a("ul",[a("li",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211010162725564.png",alt:"image-20211010162725564"}})])])]),t._v(" "),a("li",[a("p",[t._v("在创建索引时 可以通过settings设置分片")]),t._v(" "),a("ul",[a("li",[a("div",{staticClass:"language-apl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-apl"}},[a("code",[t._v("PUT stdent_index_v3\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n  "mappings"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "properties"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n      "birthday"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n        "type"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(' "date"\n      '),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n  "settings"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("{")]),t._v('\n    "number_of_shards"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v(",")]),t._v('\n    "number_of_replicas"'),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token dfn builtin"}},[t._v("}")]),t._v("\n")])])])])])]),t._v(" "),a("li",[a("p",[t._v("分片与自平衡:   es默认会交错存储分片  如果其中一个节点失效不影响访问  并且会自动将失效的分片归并到目前仍在线的节点上  节点重新上线归还分片")])]),t._v(" "),a("li",[a("p",[t._v("ES每个查询在每个分片中是单线程执行 但是可以并行处理多个分片")])]),t._v(" "),a("li",[a("p",[t._v("分片数量一旦确定好了 不能修改  但是可以通过重建索引和索引别名来迁移")])]),t._v(" "),a("li",[a("p",[t._v("索引分片推荐配置方案")]),t._v(" "),a("ol",[a("li",[t._v("每个分片推荐大小10-30GB")]),t._v(" "),a("li",[t._v("分片数量推荐 = 节点数 * 1 ~ 3 倍")])])])]),t._v(" "),a("h4",{attrs:{id:"路由原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由原理"}},[t._v("#")]),t._v(" 路由原理")]),t._v(" "),a("ul",[a("li",[t._v("文档存入对应的分片 es计算分片编号的过程 称为路由")]),t._v(" "),a("li",[t._v("路由算法 shard_index = hash(id) % number_of_shards")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211010164814898.png",alt:"image-20211010164814898"}})]),t._v(" "),a("h3",{attrs:{id:"脑裂"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脑裂"}},[t._v("#")]),t._v(" 脑裂")]),t._v(" "),a("ul",[a("li",[t._v("一个正常es集群中只有一个主节点 主节点负责管理整个集群 如创建或删除索引 跟踪哪些节点是集群的一部分 并决定哪些分片分配给相关的节点")]),t._v(" "),a("li",[t._v("集群的所有节点都会选择同一个节点作为主节点")]),t._v(" "),a("li",[t._v("脑裂问题的出现是因为从节点在选择主节点上出现分歧导致一个集群"),a("strong",[t._v("出现多个主节点")]),t._v("从而集群分离,使得集群处于异常状态")])]),t._v(" "),a("h4",{attrs:{id:"脑裂原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#脑裂原因"}},[t._v("#")]),t._v(" 脑裂原因")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("网络原因: 网络延迟   一般出现在外网集群")])]),t._v(" "),a("li",[a("p",[t._v("节点负责  主节点的角色即为master又为data 当数据访问量较大时 可能导致Master节点停止响应(假死状态)")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#是否有资格主节点")]),t._v("\nnode.master: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#是否存储数据")]),t._v("\nnode.data: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("JVM内存回收")]),t._v(" "),a("ul",[a("li",[t._v("当Master节点设置的JVM内存较小时 引发JVM的大规模内存回收 造成ES进程失去响应")])])])]),t._v(" "),a("h4",{attrs:{id:"避免脑裂"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#避免脑裂"}},[t._v("#")]),t._v(" 避免脑裂")]),t._v(" "),a("ol",[a("li",[t._v("网络原因: discovery.zen.ping.timeout 超时时间配置大一些 默认为3S")]),t._v(" "),a("li",[t._v("节点负责 角色分离   当主节点就不要当数据存储   当数据存储的就不要当主节点")]),t._v(" "),a("li",[t._v("修改 jvm.options 的最大内存和最小内存  为服务器的内存一半")])]),t._v(" "),a("h2",{attrs:{id:"集群扩容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群扩容"}},[t._v("#")]),t._v(" 集群扩容")]),t._v(" "),a("ol",[a("li",[t._v("修改所有集群中的 配置文件 添加新的集群")]),t._v(" "),a("li",[t._v("全部启动")])])])}),[],!1,null,null,null);s.default=e.exports}}]);