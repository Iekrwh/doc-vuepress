(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{385:function(s,a,t){"use strict";t.r(a);var e=t(46),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"入门案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#入门案例"}},[s._v("#")]),s._v(" 入门案例")]),s._v(" "),t("h2",{attrs:{id:"netcat的发送和监听"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#netcat的发送和监听"}},[s._v("#")]),s._v(" netcat的发送和监听")]),s._v(" "),t("p",[s._v("安装")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装netcat工具")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tunlp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#判断44444端口是否被占用")]),s._v("\n")])])]),t("p",[s._v("使用nc发送和接受消息 此操作在一个机器上 2个ssh窗口中操作")]),s._v(" "),t("p",[s._v("接受")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" -l "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听44444端口")]),s._v("\n")])])]),t("p",[s._v("发送")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" hadoop102 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发送")]),s._v("\n输入内容\n")])])]),t("p",[s._v("也可以在其他机器向指定ip 端口 发送消息")]),s._v(" "),t("p",[s._v("监听和发送的端口必须一致")]),s._v(" "),t("p",[s._v("默认为tcp协议")]),s._v(" "),t("h2",{attrs:{id:"监控端口数据在控制台输出-官方案例-netcat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控端口数据在控制台输出-官方案例-netcat"}},[s._v("#")]),s._v(" 监控端口数据在控制台输出 官方案例 netcat")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#r1:表示a1的Source的名称 多个名称之前空格隔开")]),s._v("\na1.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#k1:表示a1的Sink名称")]),s._v("\na1.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#c1:表示channels的名称")]),s._v("\na1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的输入源类型为netcat端口类型")]),s._v("\na1.sources.r1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的监听地址")]),s._v("\na1.sources.r1.bind "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的监听端口")]),s._v("\na1.sources.r1.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的输出目的地是控制台logger类型")]),s._v("\na1.sinks.k1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger  \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的channel类型是memory内存型")]),s._v("\na1.channels.c1.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的channel总容量1000个event 默认为100")]),s._v("\na1.channels.c1.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a1的channel传输时收集到了100条event以后再去提交事务")]),s._v("\na1.channels.c1.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" \n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#声明source sink 和 channel 之间的关系")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将r1和c1连接起来")]),s._v("\na1.sources.r1.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将k1和c1连接起来 注意一个sink只能对应一个channel")]),s._v("\na1.sinks.k1.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 \n")])])]),t("p",[t("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211110210311722.png",alt:"image-20211110210311722"}})]),s._v(" "),t("p",[s._v("在/opt/module/flume下启动")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("flume-ng agent --conf conf/ --name a1 --conf-file datas/netcatsource_loggersink.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或")]),s._v("\nflume-ng agent -c conf/ -n a1 -f job/flume-netcat-logger.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])])]),t("ul",[t("li",[s._v("--conf/-c：表示配置文件存储在conf/目录")]),s._v(" "),t("li",[s._v("--name/-n：表示给agent起名为a1")]),s._v(" "),t("li",[s._v("--conf-file/-f：flume本次启动读取的配置文件是在job文件夹下的flume-telnet.conf文件。")]),s._v(" "),t("li",[s._v("-Dflume.root.logger=INFO,console ：-D表示flume运行时动态修改flume.root.logger参数属性值，并将控制台日志打印级别设置为INFO级别。日志级别包括:log、info、warn、error。")])]),s._v(" "),t("p",[s._v("在另外一个ssh窗口中使用netcat发送消息")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" localhost "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#地址为配置文件中配置的地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入文字")]),s._v("\n")])])]),t("h2",{attrs:{id:"配置log4j-properties"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置log4j-properties"}},[s._v("#")]),s._v(" 配置log4j.properties")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /opt/module/flume/conf/log4j.properties \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#flume.root.logger=DEBUG,console")]),s._v("\nflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,LOGFILE "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志级别 和 输出位置")]),s._v("\nflume.log.dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("./logs "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log文件存放路径")]),s._v("\nflume.log.file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("flume.log  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log文件名")]),s._v("\n")])])]),t("h2",{attrs:{id:"实时监控单个追加文件到hdfs案例-exec"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实时监控单个追加文件到hdfs案例-exec"}},[s._v("#")]),s._v(" 实时监控单个追加文件到HDFS案例 exec")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211111104221130.png",alt:"image-20211111104221130"}})]),s._v(" "),t("p",[s._v("创建案例配置文件")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/flume/datas\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".log\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" execsource_hdfssink.conf\n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("a2.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r2\na2.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k2\na2.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听文件类型")]),s._v("\na2.sources.r2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听命令")]),s._v("\na2.sources.r2.command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F /opt/module/flume/datas/123.log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#HDFS Sink")]),s._v("\na2.sinks.k2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果要使用时间转义序列 则需要开启本地时间戳 或者 在event中headers中带时间戳")]),s._v("\na2.sinks.k2.hdfs.path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://hadoop102:8020/flume/%Y%m%d/%H\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件的前缀")]),s._v("\na2.sinks.k2.hdfs.filePrefix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logs-\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下面3个配置定义了多久时间单位创建一个新的文件夹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否按照时间滚动文件夹")]),s._v("\na2.sinks.k2.hdfs.round "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多少时间单位创建一个新的文件夹")]),s._v("\na2.sinks.k2.hdfs.roundValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新定义时间单位")]),s._v("\na2.sinks.k2.hdfs.roundUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否使用本地时间戳")]),s._v("\na2.sinks.k2.hdfs.useLocalTimeStamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#积攒多少个Event才flush到HDFS一次")]),s._v("\na2.sinks.k2.hdfs.batchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置文件类型，可支持压缩")]),s._v("\na2.sinks.k2.hdfs.fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多久生成一个新的文件 秒为单位")]),s._v("\na2.sinks.k2.hdfs.rollInterval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置每个文件的滚动大小 字节单位")]),s._v("\na2.sinks.k2.hdfs.rollSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件的滚动与Event数量无关 0为禁用 也可以设置为指定数 当Event到达一定数量则文件滚动")]),s._v("\na2.sinks.k2.hdfs.rollCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a channel which buffers events in memory")]),s._v("\na2.channels.c2.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na2.channels.c2.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na2.channels.c2.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n\na2.sources.r2.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\na2.sinks.k2.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\n")])])]),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nflume-ng agent -n a2 -c conf/ -f datas/execsource_hdfssink.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /opt/module/flume/datas/123.log "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#写入内容测试 hdfs上是否创建文件")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" ccc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /opt/module/flume/datas/123.log "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#等待60s 追内容 是否滚动文件生成新的采集文件")]),s._v("\n")])])]),t("p",[t("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211111112640291.png",alt:"image-20211111112640291"}})]),s._v(" "),t("p",[s._v("当前正在写入的文件为tmp 只有滚动文件后次缓存文件会修改为普通文件")]),s._v(" "),t("h2",{attrs:{id:"实时监控目录下多个新文件到hdfs-spooldir"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实时监控目录下多个新文件到hdfs-spooldir"}},[s._v("#")]),s._v(" 实时监控目录下多个新文件到HDFS spooldir")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211111114002805.png",alt:"image-20211111114002805"}})]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/flume/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" upload\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" datas/flume-dir-hdfs.conf\n")])])]),t("p",[s._v("配置文件")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("a3.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r3\na3.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k3\na3.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听一个指定的文件夹 自动收集目录中的内容")]),s._v("\na3.sources.r3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" spooldir\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#目录 目录下的文件名不能相同 否则抛异常")]),s._v("\na3.sources.r3.spoolDir "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/module/flume/upload\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果目录下的文件名读取完后 文件名相同 可以采取读取完后删除文件  默认为加后缀名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置为 immediate 读取完后删除 默认值为 never 保留")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#a3.sources.r3.deletePolicy = immediate")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#被读取完毕后的文件 后缀名被更改为    默认值为.COMPLETED")]),s._v("\na3.sources.r3.fileSuffix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" .COMPLETED\n\na3.sources.r3.fileHeader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#忽略所有以.tmp结尾的文件，不上传")]),s._v("\na3.sources.r3.ignorePattern "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("^ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".tmp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na3.sinks.k3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na3.sinks.k3.hdfs.path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://hadoop102:8020/flume2/upload/%Y%m%d/%H\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件的前缀")]),s._v("\na3.sinks.k3.hdfs.filePrefix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" upload-\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否按照时间滚动文件夹")]),s._v("\na3.sinks.k3.hdfs.round "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多少时间单位创建一个新的文件夹")]),s._v("\na3.sinks.k3.hdfs.roundValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新定义时间单位")]),s._v("\na3.sinks.k3.hdfs.roundUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否使用本地时间戳")]),s._v("\na3.sinks.k3.hdfs.useLocalTimeStamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#积攒多少个Event才flush到HDFS一次")]),s._v("\na3.sinks.k3.hdfs.batchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置文件类型，可支持压缩")]),s._v("\na3.sinks.k3.hdfs.fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多久生成一个新的文件")]),s._v("\na3.sinks.k3.hdfs.rollInterval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置每个文件的滚动大小大概是128M")]),s._v("\na3.sinks.k3.hdfs.rollSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件的滚动与Event数量无关")]),s._v("\na3.sinks.k3.hdfs.rollCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a channel which buffers events in memory")]),s._v("\na3.channels.c3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na3.channels.c3.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na3.channels.c3.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na3.sources.r3.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\na3.sinks.k3.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\n")])])]),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("flume-ng agent -n a3 -c conf/ -f datas/flume-dir-hdfs.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])])]),t("p",[s._v("创建文本文件写入内容 移动到upload目录下")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/flume/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".log\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" eee "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".log \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v(".log upload/\n")])])]),t("h2",{attrs:{id:"实时监控目录下的多个追加文件-taildir"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实时监控目录下的多个追加文件-taildir"}},[s._v("#")]),s._v(" 实时监控目录下的多个追加文件 taildir")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/Iekrwh/md-images/raw/master/images/image-20211111171529662.png",alt:"image-20211111171529662"}})]),s._v(" "),t("p",[s._v("我们使用exec 读取单个文件追加内容时 如果flume挂掉后重新启动 会把文件从头到尾重新读取一遍 这是我们不希望的 而taildir读取多个文件追加内容时 "),t("strong",[s._v("会在positionFile 指定的json文件下")]),s._v(" "),t("strong",[s._v("保留读取过的文件位置")]),s._v(" 当flume挂掉重新上线后 读取json文件记录的位置 继续监控读取内容")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/module/flume/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" files\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" datas/flume-taildir-hdfs.conf\n")])])]),t("p",[s._v("配置文件")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("a3.sources "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r3\na3.sinks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k3\na3.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sources类型")]),s._v("\na3.sources.r3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" TAILDIR\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#taildir保存读取文件内容的位置 如果发生宕机会从该文件中读取上次读取到位置  默认为~/.flume/taildir_position.json")]),s._v("\na3.sources.r3.positionFile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/module/flume/tail_dir.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义组 不同组 指向不同文件 多个组之间空格隔开")]),s._v("\na3.sources.r3.filegroups "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f1 f2\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#f1组 监控指定目录下名字包含file的文件 正则表达式")]),s._v("\na3.sources.r3.filegroups.f1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/module/flume/files/.*file.*\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#f2组 监控指定目录下名字包含的log的文件")]),s._v("\na3.sources.r3.filegroups.f2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /opt/module/flume/files/.*log.*\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na3.sinks.k3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na3.sinks.k3.hdfs.path "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://hadoop102:8020/flume/upload2/%Y%m%d/%H\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件的前缀")]),s._v("\na3.sinks.k3.hdfs.filePrefix "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" upload-\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否按照时间滚动文件夹")]),s._v("\na3.sinks.k3.hdfs.round "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多少时间单位创建一个新的文件夹")]),s._v("\na3.sinks.k3.hdfs.roundValue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新定义时间单位")]),s._v("\na3.sinks.k3.hdfs.roundUnit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否使用本地时间戳")]),s._v("\na3.sinks.k3.hdfs.useLocalTimeStamp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#积攒多少个Event才flush到HDFS一次")]),s._v("\na3.sinks.k3.hdfs.batchSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置文件类型，可支持压缩")]),s._v("\na3.sinks.k3.hdfs.fileType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多久生成一个新的文件")]),s._v("\na3.sinks.k3.hdfs.rollInterval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置每个文件的滚动大小大概是128M")]),s._v("\na3.sinks.k3.hdfs.rollSize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件的滚动与Event数量无关")]),s._v("\na3.sinks.k3.hdfs.rollCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a channel which buffers events in memory")]),s._v("\na3.channels.c3.type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na3.channels.c3.capacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na3.channels.c3.transactionCapacity "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na3.sources.r3.channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\na3.sinks.k3.channel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c3\n")])])]),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("flume-ng agent -n a3 -c conf/ -f datas/flume-taildir-hdfs.conf -Dflume.root.logger"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n")])])]),t("p",[s._v("测试")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" files\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" hello "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" file1.txt\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" atguigu "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" log.txt\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭flume 重新启动 查看是否还读取 aaa 和 bbb 字段")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);