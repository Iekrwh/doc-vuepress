(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{511:function(a,s,t){"use strict";t.r(s);var e=t(46),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"kafka监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka监控"}},[a._v("#")]),a._v(" Kafka监控")]),a._v(" "),t("h2",{attrs:{id:"kafka-eagle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-eagle"}},[a._v("#")]),a._v(" Kafka Eagle")]),a._v(" "),t("p",[a._v("先关闭所有kafka")]),a._v(" "),t("p",[a._v("修改kafka启动命令")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/module/kafka/bin\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" kafka-server-start.sh\n")])])]),t("p",[a._v("修改以下内容")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"x'),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$KAFKA_HEAP_OPTS")]),a._v('"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"x"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_HEAP_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-server -Xms2G -Xmx2G -XX:PermSize=128m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:ParallelGCThreads=8 -XX:ConcGCThreads=5 -XX:InitiatingHeapOccupancyPercent=70"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JMX_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"9999"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#export KAFKA_HEAP_OPTS="-Xmx1G -Xms1G"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("xsync /opt/module/kafka/bin/kafka-server-start.sh\n")])])]),t("p",[a._v("再启动kafka")]),a._v(" "),t("p",[a._v("安装eagle")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -zxvf kafka-eagle-bin-1.3.7.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" kafka-eagle-bin-1.3.7\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -zxvf kafka-eagle-web-1.3.7-bin.tar.gz -C /opt/module/\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/module/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mv")]),a._v(" kafka-eagle-web-1.3.7/ eagle\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" eagle/bin/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x ke.sh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" ke.sh\n")])])]),t("p",[a._v("修改 ke.sh")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# multi zookeeper&kafka cluster list")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\nkafka.eagle.zk.cluster.alias"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("cluster1\ncluster1.zk.list"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("hadoop102:2181,hadoop103:2181,hadoop104:2181\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kafka offset storage")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\ncluster1.kafka.eagle.offset.storage"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("kafka\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# enable kafka metrics")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\nkafka.eagle.metrics.charts"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\nkafka.eagle.sql.fix.error"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# kafka jdbc driver address")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\nkafka.eagle.driver"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("com.mysql.jdbc.Driver\nkafka.eagle.url"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("jdbc:mysql://hadoop102:3306/ke?useUnicode"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("characterEncoding")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("UTF-8"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("zeroDateTimeBehavior")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("convertToNull\nkafka.eagle.username"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root\nkafka.eagle.password"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("000000\n")])])]),t("p",[a._v("添加环境变量")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/profile.d/my_env.sh\n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KE_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/opt/module/eagle\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$KE_HOME")]),a._v("/bin\n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /etc/profile.d/my_env.sh\n")])])]),t("p",[a._v("启动")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("ke.sh start\n")])])]),t("p",[a._v("访问http://192.168.130.102:8048/ke  用户admin 密码123456")]),a._v(" "),t("h2",{attrs:{id:"kafka-monitor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-monitor"}},[a._v("#")]),a._v(" Kafka Monitor")]),a._v(" "),t("p",[a._v("目前已经停止更新了 不推荐使用")]),a._v(" "),t("p",[a._v("https://github.com/Morningstar/kafka-offset-monitor/releases")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" -p /opt/module/kafka-offset-console\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/module/kafka-offset-console\n")])])]),t("p",[a._v("将KafkaOffsetMonitor-assembly-0.4.6-SNAPSHOT.jar上传到集群中的 /opt/module/kafka-offset-console")]),a._v(" "),t("p",[a._v("创建脚本文件 start.sh")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" start.sh\n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("nohup")]),a._v(" java -cp KafkaOffsetMonitor-assembly-0.4.6-SNAPSHOT.jar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\ncom.quantifind.kafka.offsetapp.OffsetGetterWeb "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--offsetStorage kafka "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--kafkaBrokers hadoop102:9092,hadoop103:9092,hadoop104:9092 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--kafkaSecurityProtocol PLAINTEXT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--zk hadoop102:9092,hadoop103:9092,hadoop104:9092 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--port "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8086")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--refresh "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(".seconds "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--retain "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(".days "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n--dbName offsetapp_kafka "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x start.sh\n")])])]),t("p",[a._v("访问http://hadoop102:8086/查看web")]),a._v(" "),t("h2",{attrs:{id:"kafka-manager-cmak"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-manager-cmak"}},[a._v("#")]),a._v(" Kafka Manager(CMAK)")]),a._v(" "),t("p",[a._v("https://github.com/yahoo/CMAK")]),a._v(" "),t("p",[t("strong",[a._v("CMAK v3.0.0.5需要JDK11以上，如果你想用JDK1.8去支持此版本是行不通的，会报错提示找不到有些class文件")])]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" java-11-openjdk-devel.x86_64\n")])])]),t("p",[a._v("修改配置文件")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("suod "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/profile\n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("JAVA_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/usr/lib/jvm/java-11-openjdk-11.0.12.0.7-0.el7_9.x86_64\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/bin:"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("CLASSPATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(".:"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/lib/dt.jar:"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/lib/tools.jar\n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /etc/profile\njava -version\n")])])]),t("p",[a._v("上传解压")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" -p /opt/module/kafkamanager\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/module/kafkamanager\n")])])]),t("p",[a._v("修改配置")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" conf/application.conf \n")])])]),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("kafka-manager.zkhosts"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hadoop102:2181,hadoop103:2181,hadoop104:2181"')]),a._v("\nkafka-manager.zkhosts"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${?ZK_HOSTS}")]),a._v("\ncmak.zkhosts"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hadoop102:2181,hadoop103:2181,hadoop104:2181"')]),a._v("\ncmak.zkhosts"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${?ZK_HOSTS}")]),a._v("\n")])])]),t("p",[a._v("启动")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x bin/cmak\nbin/cmak\n")])])]),t("p",[a._v("访问http://hadoop102:9000/")])])}),[],!1,null,null,null);s.default=n.exports}}]);